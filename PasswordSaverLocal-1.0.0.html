<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<link rel="apple-touch-icon" sizes="180x180" href="./apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="./favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="./favicon-16x16.png">
	<link rel="manifest" href="./site.webmanifest">
	<!-- Bootstrap CSS -->
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
	      integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
	<title>Password Saver</title>
</head>
<body>
<!--<div class="alert alert-success" role="alert">-->
<!--    <button type="button" class="close" data-dismiss="alert" aria-label="Close">-->
<!--        <span aria-hidden="true">&times;</span>-->
<!--    </button>-->
<!--    <h4 class="alert-heading">Well done!</h4>-->
<!--    <p>Aww yeah, you successfully read this important alert message. This example text is going to run a bit longer so-->
<!--        that you can see how spacing within an alert works with this kind of content.</p>-->
<!--    <hr>-->
<!--    <p class="mb-0">Whenever you need to, be sure to use margin utilities to keep things nice and tidy.</p>-->
<!--</div>-->
<div class="container">
	<nav class="nav justify-content-center">
		<a class="nav-link" id="linkList">List</a>
		<a class="nav-link" id="linkAdd">Add</a>
		<a class="nav-link" id="linkExport">Export</a>
		<a class="nav-link" id="linkImport">Import</a>
	</nav>
	<div class="form-group row">
		<label for="passphrase" class="col-sm-2 col-form-label">Passphrase</label>
		<div class="col-sm-10">
			<input type="password" class="form-control" id="passphrase" placeholder="Passphrase" autocomplete="off">
		</div>
	</div>
	<ul class="list-unstyled" id="localListViewUL">
		<!-- Sample List Element -->
		<!--		<li class="media">-->
		<!--			<div class="media-body">-->
		<!--				<h5 class="mt-0 mb-1">Google</h5>-->
		<!--				@username-->
		<!--				<br/>-->
		<!--				<br/>-->
		<!--				<button type="button" class="btn btn-primary">Copy Username</button>-->
		<!--				<button type="button" class="btn btn-success">Copy Password</button>-->
		<!--				<br/>-->
		<!--				<br/>-->
		<!--				<button type="button" class="btn btn-secondary">Edit</button>-->
		<!--				<button type="button" class="btn btn-info">Print</button>-->
		<!--			</div>-->
		<!--		</li>-->
		<!--		<li class="media my-4">-->
		<!--&lt;!&ndash;			<img src="https://mysupershopper.com/wp-content/uploads/2020/03/MySuperShopper1024x1024.png" width="64" height="64" class="mr-3" alt="">&ndash;&gt;-->
		<!--			<div class="media-body">-->
		<!--				<h5 class="mt-0 mb-1">Password Training</h5>-->
		<!--				Upgrade yourself. Learn mobile lessons from a top expert in the field.-->
		<!--			</div>-->
		<!--		</li>-->
	</ul>
	<div id="localFormView" style="display: none;">
		<div class="form-group row">
			<label for="siteApp" class="col-sm-2 col-form-label">Site / App</label>
			<div class="col-sm-10">
				<input type="text" class="form-control" id="siteApp" placeholder="Site / App">
			</div>
		</div>
		<div class="form-group row">
			<label for="emailUsername" class="col-sm-2 col-form-label">Email / Username</label>
			<div class="col-sm-10">
				<input type="email" class="form-control" id="emailUsername" placeholder="Email / Username"
				       autocomplete="off">
			</div>
		</div>
		<div class="form-group row">
			<label for="inputPassword" class="col-sm-2 col-form-label">Password</label>
			<div class="col-sm-10">
				<div class="input-group">
					<input type="text" class="form-control" id="inputPassword" placeholder="Password">
					<div class="input-group-append" id="button-addon4">
						<button class="btn btn-outline-primary" type="button" id="inputPasswordGenerate"
						        data-toggle="modal" data-target="#generatePasswordModal">
							Generate
						</button>
						<button class="btn btn-outline-success" type="button" id="inputPasswordCopy">Copy</button>
					</div>
				</div>
			</div>
		</div>
		<!-- Modal -->
		<div class="modal fade" id="generatePasswordModal" tabindex="-1" role="dialog"
		     aria-labelledby="generatePasswordModalLabel" aria-hidden="true">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title" id="exampleModalLabel">Generate Password</h5>
						<button type="button" class="close" data-dismiss="modal" aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
					</div>
					<div class="modal-body">
						<div class="inner-section">
							<div class="password-section">
								<div class="pass-field" id="pass-field">

								</div>
								<!--								<button id="copy" class="copy">Copy</button>-->
								<div class="alert" id="alert"><span class="message" id="message"></span></div>
							</div>
							<p class="info">Select your options and click the "Generate" button. Then your password will
								appear above.</p>
							<div class="controls">
								<div class="control length" id="length-box">
									<label for="length">Password Length</label>
									<input type="range" id='length' min="4" max="20" list="ranges">
									<datalist id="ranges">
										<option value="4" label="4">
										<option value="5">
										<option value="6">
										<option value="7">
										<option value="8">
										<option value="9">
										<option value="10">
										<option value="11">
										<option value="12" label="12">
										<option value="13">
										<option value="14">
										<option value="15">
										<option value="16">
										<option value="17">
										<option value="18">
										<option value="19">
										<option value="20">
									</datalist>
								</div>
								<div class="control">
									<input type="checkbox" id="lowercase" checked>
									<label class="check-label" for="lowercase"><span
											class="checkbox">Use Lowercase Characters</span></label>
								</div>
								<div class="control">
									<input type="checkbox" id="uppercase" checked>
									<label class="check-label" for="uppercase"><span
											class="checkbox">Use Uppercase Characters</span></label>
								</div>
								<div class="control">
									<input type="checkbox" id="numbers" checked>
									<label class="check-label" for="numbers"><span
											class="checkbox">Use Numbers</span></label>
								</div>
								<div class="control">
									<input type="checkbox" id="punctuation" checked>
									<label class="check-label" for="punctuation"><span
											class="checkbox">Use special characters</span></label>
								</div>

								<button class="btn btn-success generate" id="generate">Generate!</button>
							</div>
						</div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
						<button type="button" class="btn btn-primary" id="useThisPassword" data-dismiss="modal">Use This
							Password
						</button>
					</div>
				</div>
			</div>
		</div>
		<div class="form-group row">
			<label for="inputLink" class="col-sm-2 col-form-label">Link</label>
			<div class="col-sm-10">
				<input type="url" class="form-control" id="inputLink" placeholder="https://">
			</div>
		</div>
		<!--		<div class="form-group row">-->
		<!--			<div class="col-sm-2">2 Factor Authentication</div>-->
		<!--			<div class="col-sm-10">-->
		<!--				<div class="form-check">-->
		<!--					<input class="form-check-input" type="checkbox" id="checkboxHas2Factor">-->
		<!--					<label class="form-check-label" for="checkboxHas2Factor">-->
		<!--						Has 2 Factor Authentication-->
		<!--					</label>-->
		<!--				</div>-->
		<!--			</div>-->
		<!--		</div>-->
		<div class="form-group row">
			<div class="col-sm-10">
				<button type="submit" class="btn btn-success" id="saveButton">Save</button>
				<button type="submit" class="btn btn-primary" id="duplicateButton">Duplicate</button>
				<button type="submit" class="btn btn-danger" id="deleteButton">Delete</button>
			</div>
		</div>
	</div>
	<div id="localImportView" style="display: none;">
		<div class="form-group row">
			<label for="passphraseImport" class="col-sm-2 col-form-label">Import Passphrase</label>
			<div class="col-sm-10">
				<input type="password" class="form-control" id="passphraseImport" placeholder="Import Passphrase">
			</div>
		</div>
		<div class="form-group row">
			<label for="import" class="col-sm-2 col-form-label">Import</label>
			<div class="col-sm-10">
				<textarea class="form-control" id="import" rows="20"
				          style="white-space: nowrap; overflow: auto; font-family: 'Courier New',monospace"
				          placeholder="Paste Your Export"></textarea>
			</div>
		</div>
		<div class="form-group row">
			<div class="col-sm-10 offset-sm-2">
				<button type="submit" class="btn btn-success" id="importKeepButton">Import By Adding</button>
				<button type="submit" class="btn btn-warning" id="importClearButton">Import By Clearing First</button>
			</div>
		</div>
	</div>
	<div id="localExportView" style="display: none;">
		<div class="form-group row">
			<label for="export" class="col-sm-2 col-form-label">Export</label>
			<div class="col-sm-10">
				<textarea class="form-control" id="export" rows="20"
				          style="white-space: nowrap; overflow: auto; font-family: 'Courier New',monospace"></textarea>
			</div>
		</div>
		<div class="form-group row">
			<div class="col-sm-10 offset-sm-2">
				<button type="submit" class="btn btn-primary" id="copyExportButton">Copy</button>
				<a id="downloadExportButton" target="_blank">
					<button type="submit" class="btn btn-success">Download</button>
				</a>
			</div>
		</div>
	</div>
	<div id="localAboutView" style="display: none;">
		<div class="row">
			<div class="col-sm-12">
				<h2>About</h2>

				<p>Quick Password Saver was created by Kevin Fry to provide security and password training as well as low
					cost lifetime access to software and updates to that software that run on the web, and in the cloud.</p>
			</div>
		</div>
	</div>
	<div id="localContactView" style="display: none;">
		<div class="row">
			<div class="col-sm-12">
				<h2>Contact</h2>

				<p>For assistance, please visit our <a href="https://quickpasswordsaver.com/helpdesk/" target="_blank">Help
					Desk</a></p>
				<p>For an e-mail response: <a href="mailto:support@quickpasswordsaver.com" target="_blank">support@quickpasswordsaver.com</a>
				</p>
				<p>Leave a voicemail or send a text: <a href="tel:+1 (267) 908-4513" target="_blank">+1 (267) 908-4513</a>
				</p>
			</div>
		</div>
	</div>
	<div id="localHelpView" style="display: none;">
		<div class="row">
			<div class="col-sm-12">
				<h2>Help</h2>

				<p>For assistance, please visit our <a href="https://quickpasswordsaver.com/helpdesk/" target="_blank">Help
					Desk</a></p>
			</div>
		</div>
	</div>
	<ul class="nav justify-content-center">
		<li class="nav-item">
			<a class="nav-link" id="linkHome">Home</a>
		</li>
		<li class="nav-item">
			<a class="nav-link" id="linkAbout">About</a>
		</li>
		<li class="nav-item">
			<a class="nav-link" id="linkContact">Contact</a>
		</li>
		<li class="nav-item">
			<a class="nav-link" id="linkHelp">Help</a>
		</li>
	</ul>
</div>

<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"></script>
<script src="js/aes.js"></script>
<script src="js/pbkdf2.js"></script>
<script>
	// Password Saver
	// by Kevin Fry
	// src="index.js"

	window.addEventListener("DOMContentLoaded", function () {
		let keySize = 256;
		//let ivSize = 128;
		let iterations = 100;

		function isValidForDisplay(a) {
			// the most annoying
			if (a === undefined) {
				return false;
			}
			// this one can happen too
			if (a === null) {
				return false;
			}
			// mobile first -> if it's not there, let's not show it
			if (a.toString() === '') {
				return false;
			}
			// some data sets might return this
			if (a.toString() === 'null') {
				return false;
			}

			// eh, another condition that may remain
			return a.toString() !== 'n/a';
		}

		let lowercase = "abcdefghijklmnopqrstuvwxyz",
				uppercase = "ABCDEFGHIJKLMNOPQRSTUVWXYZ",
				numbers = "0123456789",
				punctuation = "!@#$%^&*()_+~`|}{[]:;?><,./-=",
				lowercaseInput = document.getElementById("lowercase"),
				uppercaseInput = document.getElementById("uppercase"),
				punctuationInput = document.getElementById("punctuation"),
				numbersInput = document.getElementById("numbers"),
				lengthInput = document.getElementById("length"),
				passwordField = document.getElementById("pass-field"),
				generateButton = document.getElementById("generate"),
				copyButton = document.getElementById("useThisPassword"),
				pLength,
				userPassword,
				passwordCharSet;

		function generate() {
			userPassword = "";
			passwordCharSet = "";
			if (lowercaseInput.checked) {
				passwordCharSet += lowercase;
			}
			if (uppercaseInput.checked) {
				passwordCharSet += uppercase;
			}
			if (punctuationInput.checked) {
				passwordCharSet += punctuation;
			}
			if (numbersInput.checked) {
				passwordCharSet += numbers;
			}
			pLength = Number(lengthInput.value);

			for (let i = 0; i < pLength; i++) {
				userPassword += passwordCharSet.charAt(
						Math.floor(Math.random() * passwordCharSet.length)
				);
			}
			if (userPassword === "") {
				let alertBox = document.getElementById('alert');
				alertBox.innerHTML = "Please select an option before generating"
				alertBox.classList.add('fail');
				setTimeout(function () {
					alertBox.classList.remove('fail');
				}, 3000);
			} else {
				passwordField.innerHTML = userPassword;
			}
			copyButton.setAttribute("data-clipboard-text", userPassword);
		}

		generateButton.addEventListener("click", generate);
		copyButton.addEventListener("click", function (e) {
			e.preventDefault();
			document.getElementById('inputPassword').value = copyButton.getAttribute("data-clipboard-text");
		});

		function getEId(x) {
			return document.getElementById(x);
		}

		let btnEditElements = document.getElementsByClassName("btnEdit");
		let btnGoToElements = document.getElementsByClassName("btnGoTo");

		// https://embed.plnkr.co/0VPU1zmmWC5wmTKPKnhg/
		function encryptUserData(msg, pass) {
			let salt = CryptoJS.lib.WordArray.random(128 / 8);

			let key = CryptoJS.PBKDF2(pass, salt, {
				keySize: keySize / 32,
				iterations: iterations
			});

			let iv = CryptoJS.lib.WordArray.random(128 / 8);

			let encrypted = CryptoJS.AES.encrypt(msg, key, {
				iv: iv,
				padding: CryptoJS.pad.Pkcs7,
				mode: CryptoJS.mode.CBC

			});

			return salt.toString() + iv.toString() + encrypted.toString();
		}

		function decryptUserData(transitMessage, pass) {
			if (isValidForDisplay(transitMessage) && isValidForDisplay(pass)) {
				let salt = CryptoJS.enc.Hex.parse(transitMessage.substr(0, 32));
				let iv = CryptoJS.enc.Hex.parse(transitMessage.substr(32, 32))
				let encrypted = transitMessage.substring(64);

				let key = CryptoJS.PBKDF2(pass, salt, {
					keySize: keySize / 32,
					iterations: iterations
				});

				let decrypted = CryptoJS.AES.decrypt(encrypted, key, {
					iv: iv,
					padding: CryptoJS.pad.Pkcs7,
					mode: CryptoJS.mode.CBC
				});

				try {
					return decrypted.toString(CryptoJS.enc.Utf8);
				} catch (err) {
					return '';
				}
			} else {
				return '';
			}
		}

		function copyElementToClipboard(hidden) {
			let copyText = getEId(hidden);
			copyText.style.display = "block";
			copyText.select();
			copyText.setSelectionRange(0, 99999); /* For mobile devices */
			document.execCommand("copy");
			if ((hidden !== "inputPassword") && (hidden !== "export")) {
				copyText.style.display = "none";
			}
			copyText.blur();
		}

		let getData = function () {
			let passphrase = getEId('passphrase').value;
			let validRecords = 0;
			getEId("localListViewUL").innerHTML = '<input class="form-control" id="searchInput" type="text" placeholder="Search..">';
			for (let i = 0, len = localStorage.length; i < len; i++) {
				let key = localStorage.key(i);
				if (key.substring(0, 4) !== 'qpsl') {
					continue;
				}
				let value = localStorage.getItem(key);
				let obj = JSON.parse(value);
				/**
                 <li class="media">
                 <div class="media-body">
                 <h5 class="mt-0 mb-1">Google</h5>
                 @username
                 <br/>
                 <br/>
                 <button type="button" class="btn btn-primary btnCopyUsername">Copy Username</button>
                 <button type="button" class="btn btn-success">Copy Password</button>
                 <br/>
                 <br/>
                 <button type="button" class="btn btn-secondary">Edit</button>
                 <button type="button" class="btn btn-info">Print</button>
                 </div>
                 </li>
				 */
				let item = document.createElement("li");
				item.className = "media";
				let mediaBodyDiv = document.createElement("div");
				mediaBodyDiv.className = "media-body";
				let site_app = document.createElement("h5");
				site_app.className = "mt-0 mb-1";
				let siteAppText = document.createTextNode(decryptUserData(obj.site_app, passphrase));
				site_app.appendChild(siteAppText);
				let emailUsernameTextTxt = decryptUserData(obj.email_username, passphrase);
				let emailUsernameText = document.createTextNode(emailUsernameTextTxt);
				//let br = document.createElement("br");
				//br.style.clear = "left";
				//let br1 = document.createElement("br");
				//br.style.clear = "left";
				let br2 = document.createElement("br");
				//br.style.clear = "left";
				//let br3 = document.createElement("br");
				//br.style.clear = "left";

				let usernameHidden = document.createElement("input");
				let passwordHidden = document.createElement("input");
				usernameHidden.type = "text";
				passwordHidden.type = "text";
				usernameHidden.style.display = "none";
				passwordHidden.style.display = "none";
				usernameHidden.id = "usernameHidden" + key;
				passwordHidden.id = "passwordHidden" + key;
				usernameHidden.setAttribute("data-key", key);
				passwordHidden.setAttribute("data-key", key);
				usernameHidden.value = decryptUserData(obj.email_username, passphrase);
				passwordHidden.value = decryptUserData(obj.password, passphrase);

				let copyUsernameButton = document.createElement("button");
				copyUsernameButton.className = "btn btn-primary btnCopyUsername";
				copyUsernameButton.type = "button";
				let copyUsernameText = document.createTextNode("Copy Username");
				copyUsernameButton.appendChild(copyUsernameText);//function(){modifyText("four")}
				// getEId("usernameHidden" + key).removeEventListener("click", function () {
				//     copyElementToClipboard("usernameHidden" + key)
				// }, false);
				copyUsernameButton.addEventListener("click", function () {
					copyElementToClipboard("usernameHidden" + key)
				}, false);

				let copyPasswordButton = document.createElement("button");
				copyPasswordButton.className = "btn btn-success btnCopyPassword";// float-right
				copyPasswordButton.type = "button";
				let copyPasswordText = document.createTextNode("Copy Password");
				copyPasswordButton.appendChild(copyPasswordText);
				// getEId("passwordHidden" + key).removeEventListener("click", function () {
				//     copyElementToClipboard("passwordHidden" + key)
				// }, false);
				copyPasswordButton.addEventListener("click", function () {
					copyElementToClipboard("passwordHidden" + key)
				}, false);

				let editButton = document.createElement("button");
				editButton.className = "btn btn-secondary btnEdit";
				editButton.type = "button";
				editButton.setAttribute("data-key", key);
				let editText = document.createTextNode("Edit");
				editButton.appendChild(editText);

				// let printButton = document.createElement("button");
				// printButton.className = "btn btn-info btnPrint";
				// printButton.type = "button";
				// printButton.setAttribute("data-key", key);
				// let printText = document.createTextNode("Print");
				// printButton.appendChild(printText);

				let goToButton = document.createElement("button");
				goToButton.className = "btn btn-link btnGoTo float-right";
				goToButton.type = "button";
				goToButton.setAttribute("data-key", key);
				let goToButtonText = document.createTextNode('Go To ' + decryptUserData(obj.site_app, passphrase));
				goToButton.appendChild(goToButtonText);

				mediaBodyDiv.append(site_app);
				mediaBodyDiv.append(emailUsernameText);
				mediaBodyDiv.append(usernameHidden);
				mediaBodyDiv.append(copyUsernameButton);
				mediaBodyDiv.append(passwordHidden);
				mediaBodyDiv.append(copyPasswordButton);
				mediaBodyDiv.append(br2);
				mediaBodyDiv.append(editButton);
				// mediaBodyDiv.append(printButton);
				mediaBodyDiv.append(goToButton);
				item.appendChild(mediaBodyDiv);

				if (isValidForDisplay(decryptUserData(obj.site_app, passphrase)) || isValidForDisplay(decryptUserData(obj.email_username, passphrase)) || isValidForDisplay(decryptUserData(obj.email_username, passphrase)) || isValidForDisplay(decryptUserData(obj.password, passphrase))) {
					document.getElementById("localListViewUL").appendChild(item);
					validRecords++;
				}
			}
			document.getElementById("searchInput").onkeyup = function () {
				let searchText = document.getElementById("searchInput").value;
				searchText.toLowerCase();
				let searchLIs = document.getElementsByTagName('li');
				for (let a = 0; a < searchLIs.length; a++) {
					if (!(searchLIs[a].classList.contains('media'))) {
						continue;
					}
					let searchTree = searchLIs[a].innerText;
					if (searchTree.toLowerCase().indexOf(searchText) > -1) {
						searchLIs[a].style.display = "block";
					} else {
						searchLIs[a].style.display = "none";
					}
				}
			};
			if (validRecords === 0) {
				getEId("localListViewUL").innerHTML = '';
			}
		};

		function showLinkList() {
			getEId("localAboutView").style.display = "none";
			getEId("localHelpView").style.display = "none";
			getEId("localContactView").style.display = "none";
			getEId("localExportView").style.display = "none";
			getEId("localImportView").style.display = "none";
			getEId("localFormView").style.display = "none";
			getEId("localListViewUL").style.display = "block";
			getData();
			for (let i = 0; i < btnEditElements.length; i++) {
				btnEditElements[i].addEventListener('click', preEditStoreData, false);
			}
			for (let i = 0; i < btnGoToElements.length; i++) {
				btnGoToElements[i].addEventListener('click', goToLinkClick, false);
			}
		}

		function showLinkAdd() {
			getEId("localAboutView").style.display = "none";
			getEId("localHelpView").style.display = "none";
			getEId("localContactView").style.display = "none";
			getEId("localExportView").style.display = "none";
			getEId("localImportView").style.display = "none";
			getEId("localListViewUL").style.display = "none";
			getEId("localFormView").style.display = "block";
			getEId('saveButton').removeAttribute("data-key");
			getEId('duplicateButton').removeAttribute("data-key");
			getEId('siteApp').value = "";
			getEId('emailUsername').value = "";
			getEId('inputPassword').value = "";
			getEId('inputLink').value = "https://";

			return true;
		}

		function showLinkExport() {
			getEId("localAboutView").style.display = "none";
			getEId("localHelpView").style.display = "none";
			getEId("localContactView").style.display = "none";
			getEId("localListViewUL").style.display = "none";
			getEId("localFormView").style.display = "none";
			getEId("localImportView").style.display = "none";
			getEId("localExportView").style.display = "block";

			getEId("localListViewUL").innerHTML = "";
			let text = '';
			for (let i = 0, len = localStorage.length; i < len; i++) {
				let key = localStorage.key(i);
				let value = localStorage.getItem(key);
				text += key + '\t' + value + '\r\n';
			}
			let textExport = text;
			text.replace(/\r?\n/g, '<br>');
			document.getElementById("export").innerHTML = text;

			getEId("downloadExportButton").setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(textExport));
			getEId("downloadExportButton").setAttribute('download', "encrypted.txt");
		}

		function showLinkImport() {
			getEId("localAboutView").style.display = "none";
			getEId("localHelpView").style.display = "none";
			getEId("localContactView").style.display = "none";
			getEId("localListViewUL").style.display = "none";
			getEId("localFormView").style.display = "none";
			getEId("localExportView").style.display = "none";
			getEId("localImportView").style.display = "block";
		}

		function showLinkHome() {
			window.location.reload();
		}

		function showLinkAbout() {
			getEId("localListViewUL").style.display = "none";
			getEId("localFormView").style.display = "none";
			getEId("localImportView").style.display = "none";
			getEId("localExportView").style.display = "none";

			getEId("localContactView").style.display = "none";
			getEId("localHelpView").style.display = "none";
			getEId("localAboutView").style.display = "block";

		}

		function showLinkContact() {
			getEId("localListViewUL").style.display = "none";
			getEId("localFormView").style.display = "none";
			getEId("localImportView").style.display = "none";
			getEId("localExportView").style.display = "none";

			getEId("localAboutView").style.display = "none";
			getEId("localHelpView").style.display = "none";
			getEId("localContactView").style.display = "block";
		}

		function showLinkHelp() {
			getEId("localListViewUL").style.display = "none";
			getEId("localFormView").style.display = "none";
			getEId("localImportView").style.display = "none";
			getEId("localExportView").style.display = "none";

			getEId("localAboutView").style.display = "none";
			getEId("localContactView").style.display = "none";
			getEId("localHelpView").style.display = "block";
		}

		function deleteData() {
			let id = this.getAttribute("data-key");

			if (id && (id !== "")) {
				localStorage.removeItem(id);
			}
			showLinkList();
		}

		function storeData() {
			let id, site_app, email_username, password, link, passphrase;
			let key = this.getAttribute("data-key");

			if (!key || key === "") {
				id = 'qpsl' + Math.floor(Date.now());
			} else {
				id = key;
			}

			passphrase = getEId('passphrase').value;
			site_app = encryptUserData(getEId('siteApp').value, passphrase);
			email_username = encryptUserData(getEId('emailUsername').value, passphrase);
			password = encryptUserData(getEId('inputPassword').value, passphrase);
			link = encryptUserData(getEId('inputLink').value, passphrase);

			let item = {
				"site_app": site_app,
				"email_username": email_username,
				"password": password,
				"link": link
			};
			//console.log(passphrase, site_app, email_username, password, link);

			let info = JSON.stringify(item);
			localStorage.setItem(id, info);

			showLinkList();
		}


		function preEditStoreData() {
			showLinkAdd();
			let id, text_site_app, text_email_username, text_password, text_link, passphrase;
			let key = this.getAttribute("data-key");

			if (!key || key === "") {
				id = 'qpsl' + Math.floor(Date.now());
			} else {
				id = key;
			}

			let value = localStorage.getItem(id);
			let obj = JSON.parse(value);
			getEId('saveButton').setAttribute("data-key", key);
			getEId('saveButton').innerText = "Update / Save";
			getEId('deleteButton').setAttribute("data-key", key);
			getEId('duplicateButton').removeAttribute("data-key");
			getEId('duplicateButton').innerText = "Duplicate / New";
			passphrase = getEId('passphrase').value;
			text_site_app = decryptUserData(obj.site_app, passphrase);
			text_email_username = decryptUserData(obj.email_username, passphrase);
			text_password = decryptUserData(obj.password, passphrase);
			text_link = decryptUserData(obj.link, passphrase);

			getEId('siteApp').value = text_site_app;
			getEId('emailUsername').value = text_email_username;
			getEId('inputPassword').value = text_password;
			getEId('inputLink').value = text_link;
			// let item = {
			//     "site_app": site_app,
			//     "email_username": email_username,
			//     "password": password,
			//     "link": link
			// };
			//
			// let info = JSON.stringify(item);
			// localStorage.setItem(id, info);
		}

		function goToLinkClick() {
			let id;
			let key = this.getAttribute("data-key");

			if (!key || key === "") {
				id = Math.floor(Date.now());
			} else {
				id = key;
			}

			let value = localStorage.getItem(id);
			let obj = JSON.parse(value);
			let passphrase = getEId('passphrase').value;
			let text_link = decryptUserData(obj.link, passphrase);

			window.open(text_link, '_blank');
		}

		// https://webdevtrick.com/javascript-random-password-generator/
		function importKeep() {
			let importText = getEId('import').value;
			let lines = importText.split(/\r\n|\r|\n/g);
			for (let j = 0, len = lines.length; j < len; j++) {
				let cols = lines[j].split('\t');
				let key = 'qpsl' + Math.floor(Date.now()) + j;
				let data;
				if (isValidForDisplay(cols[1])) {
					data = JSON.parse(cols[1]);
				} else {
					continue;
				}
				let passphraseImport = getEId('passphraseImport').value;
				let text_site_app, text_email_username, text_password, text_link, passphrase,
						site_app, email_username, password, link;
				text_site_app = decryptUserData(data.site_app, passphraseImport);
				text_email_username = decryptUserData(data.email_username, passphraseImport);
				text_password = decryptUserData(data.password, passphraseImport);
				text_link = decryptUserData(data.link, passphraseImport);

				passphrase = getEId('passphrase').value;
				site_app = encryptUserData(text_site_app, passphrase);
				email_username = encryptUserData(text_email_username, passphrase);
				password = encryptUserData(text_password, passphrase);
				link = encryptUserData(text_link, passphrase);

				let item = {
					"site_app": site_app,
					"email_username": email_username,
					"password": password,
					"link": link
				};

				let info = JSON.stringify(item);
				localStorage.setItem(key, info);
			}

			showLinkList();
		}

		function importClear() {
			localStorage.clear();

			importKeep();
		}

		getEId('saveButton').addEventListener('click', storeData, false);
		getEId('duplicateButton').addEventListener('click', storeData, false);
		getEId('deleteButton').addEventListener('click', deleteData, false);

		getEId('linkList').addEventListener('click', showLinkList, false);
		getEId('linkAdd').addEventListener('click', showLinkAdd, false);
		getEId('linkExport').addEventListener('click', showLinkExport, false);
		getEId('linkImport').addEventListener('click', showLinkImport, false);

		getEId('importKeepButton').addEventListener('click', importKeep, false);
		getEId('importClearButton').addEventListener('click', importClear, false);

		getEId('linkHome').addEventListener('click', showLinkHome, false);
		getEId('linkAbout').addEventListener('click', showLinkAbout, false);
		getEId('linkContact').addEventListener('click', showLinkContact, false);
		getEId('linkHelp').addEventListener('click', showLinkHelp, false);

		getEId('inputPasswordCopy').addEventListener("click", function () {
			copyElementToClipboard("inputPassword");
		}, false);

		getEId('copyExportButton').addEventListener("click", function () {
			copyElementToClipboard("export");
		}, false);
		// getEId('downloadExportButton').addEventListener("click", function () {
		//     copyElementToFile("export");
		// }, false);

		// $("#searchInput").on("keyup", function() {
		//     var value = $(this).val().toLowerCase();
		//     $("#localListViewUL *").filter(function() {
		//         $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
		//     });
		// });

		showLinkList();
	}); // end dom content loaded

</script>
</body>
</html>
